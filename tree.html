<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8" />
    <title>OrgChart</title>
    <link rel="shortcut icon" type="image/x-icon" href="misc/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!----------------   ORG CHART NON ESSENTIAL CONTENT ------------>
    <script src="https://unpkg.com/html2canvas@1.1.4/dist/html2canvas.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/simptip@1.0.4/simptip.min.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />

    <style>
      [data-tooltip]:focus:after {
        display: none;
          border-bottom-color: transparent !important;
      }

      [data-tooltip]:focus:before {
        display: none;
        border-bottom-color: transparent !important;
      }

      [data-tooltip]:after {
        height: auto !important;
        padding: 11px 11px 11px 11px !important;
        content: attr(data-tooltip);
        white-space: pre;
        line-height: 16px !important;
        text-align: left !important;
      }

      .chart-container {
        padding-top: 10px;
        height: 1200px;
        background-color: white;
      }

      .node.dragging .node-rect {
        stroke: #ff6363;
        stroke-width: 10;
        fill: #fff;
      }

      .node:not(.dragging).drop-over .node-rect {
        stroke: #ccc;
        stroke-width: 10;
      }
    </style>
  </head>

  <body>
    <div class="action-buttons" style="margin: 0 100px">
      <button
        onclick='chart.setExpanded("103").render()'
        class="simptip-position-bottom"
        data-tooltip='chart.setExpanded("103") &#xa; .render()'
      >
        Expand #103
      </button>
      <button
        onclick='chart.setExpanded("103",false).render()'
        class="simptip-position-bottom"
        data-tooltip='chart.setExpanded("103",false) &#xa; .render()'
      >
        Collapse #103
      </button>
      <button
        onclick='chart.addNode({id:"root child",parentId:"100",name:"test-name",position:"test-position",_centered:true})'
        class="simptip-position-bottom"
        data-tooltip='chart.addNode({id:"root child",parentId:"100",name:"test name",position:"test position"})'
      >
        Add node as roots' child
      </button>
      <button onclick='chart.removeNode("120")' class="simptip-position-bottom" data-tooltip='chart.removeNode("120")'>
        Remove #120
      </button>
      <button onclick="chart.fit()" class="simptip-position-bottom" data-tooltip="chart.fit()">Fit</button>
      <button
        onclick='chart.layout(["right","bottom","left","top"][index++%4]).render().fit()'
        class="simptip-position-bottom"
        data-tooltip='chart.layout(["right","bottom","left","top"][index++%4]) &#xa; .render() &#xa; .fit()'
      >
        Swap Layouts
      </button>

      <button
        onclick='chart.setCentered("134").render()'
        class="simptip-position-bottom"
        data-tooltip='chart.setCentered("134") &#xa; .render()'
      >
        Center #134
      </button>
      <button
        onclick='chart.setHighlighted("134").render()'
        class="simptip-position-bottom"
        data-tooltip='chart.setHighlighted("134") &#xa; .render()'
      >
        Highlight #134
      </button>
      <button
        onclick='chart.setUpToTheRootHighlighted("134").render()'
        class="simptip-position-bottom"
        data-tooltip='chart.setUpToTheRootHighlighted("134") &#xa; .render()'
      >
        Highlight #134 to root
      </button>
      <button
        onclick="chart.clearHighlighting()"
        class="simptip-position-bottom"
        data-tooltip="chart.clearHighlighting() &#xa; .render()"
      >
        Clear highlighting
      </button>
      <button onclick="chart.fullscreen()" class="simptip-position-bottom" data-tooltip="chart.fullscreen()">
        Full Screen
      </button>
      <button onclick="chart.zoom(1)" class="simptip-position-bottom" data-tooltip="chart.zoom(1)">Zoom Reset</button>
      <button onclick="chart.zoomIn()" class="simptip-position-bottom" data-tooltip="chart.zoomIn()">Zoom In</button>
      <button onclick="chart.zoomOut()" class="simptip-position-bottom" data-tooltip="chart.zoomOut()">Zoom Out</button>
      <button onclick="chart.exportImg()" class="simptip-position-bottom" data-tooltip="chart.exportImg()">
        Export Current Image
      </button>
      <button
        onclick="chart.exportImg({full:true})"
        class="simptip-position-bottom"
        data-tooltip="chart.exportImg({full:true})"
      >
        Export Export Full Image
      </button>
      <button onclick="chart.exportSvg()" class="simptip-position-bottom" data-tooltip="chart.exportSvg()">
        Export SVG
      </button>
      <button onclick="chart.expandAll()" class="simptip-position-bottom" data-tooltip="chart.expandAll()">
        Expand All
      </button>
      <button onclick="chart.collapseAll()" class="simptip-position-bottom" data-tooltip="chart.collapseAll()">
        Collapse All
      </button>
      <button
        onclick='chart.connections([{from:"145",to:"201",label:"Conflicts of interest"}]).render()'
        class="simptip-position-bottom"
        data-tooltip='chart.connections({from:"",to:""}) &#xa; .render()'
      >
        Multi Node Connections
      </button>

      <button onclick="downloadPdf()" class="simptip-position-bottom" data-tooltip="downloadPdf()">Download PDF</button>

      <script>
        function downloadPdf() {
          chart.exportImg({
            save: false,
            onLoad: (base64) => {
              var pdf = new jspdf.jsPDF();
              var img = new Image();
              img.src = base64;
              img.onload = function () {
                pdf.addImage(img, 'JPEG', 5, 5, 595 / 3, ((img.height / img.width) * 595) / 3);
                pdf.save('chart.pdf');
              };
            },
          });
        }
      </script>
    </div>

    <a href="https://github.com/bumbeishvili/d3-organization-chart">
      <img
        style="position: fixed; top: 0; right: 0; border: 0; z-index: 2"
        width="149"
        height="149"
        src="https://bumbeishvili.github.io/d3-tooltip/forkme.png"
        alt="Fork me on GitHub"
      />
    </a>

    <!----------------  ORG CHART ESSENTIAL CONTENT ---------------->

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="./build/d3-org-chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-flextree@2.1.2/build/d3-flextree.js"></script>
    <div class="chart-container"></div>

    <script>
      let index = 0;
      let chart;
      d3.csv('misc/data.csv').then((dataFlattened) => {
        chart = new d3.OrgChart()
          .container('.chart-container')
          .data(dataFlattened)
          .nodeHeight(() => 85 + 25)
          .nodeWidth(() => 220 + 2)
          .childrenMargin(() => 50)
          .compactNoChildren(true)
          .onNodeClick(() => console.log('ok'))
          .compactMarginBetween(() => 35)
          .compactMarginPair(() => 30)
          .neighbourMargin(() => 40)
          .dragNDrop(true)
          .onNodeDrop(function (sourceNodeData, targetNodeData) {
            console.log(sourceNodeData, targetNodeData);
            return true;
          })
          .isNodeDraggable(() => true)
          .isNodeDroppable(() => {
            return true;
          });

        chart.layoutBindings(
          (() => {
            const layouts = chart.layoutBindings();
            layouts.top.linkY = (node) => node.y + 0;
            layouts.top.linkCompactYStart = (node) => node.y + node.height / 2 + 15;
            return layouts;
          })(),
        );

        chart.render();
      });
    </script>
  </body>
</html>
