<!DOCTYPE html>

<html>
<head>
  <meta charset="UTF-8" />
  <title>OrgChart</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://unpkg.com/html2canvas@1.1.4/dist/html2canvas.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/simptip@1.0.4/simptip.min.css" rel="stylesheet" />

  <style>
      [data-tooltip]:focus:after {
          display: none;
          border-bottom-color: transparent !important;
      }

      [data-tooltip]:focus:before {
          display: none;
          border-bottom-color: transparent !important;
      }

      [data-tooltip]:after {
          height: auto !important;
          padding: 11px 11px 11px 11px !important;
          content: attr(data-tooltip);
          white-space: pre;
          line-height: 16px !important;
          text-align: left !important;
      }

      .chart-container {
          padding-top: 10px;
          height: 1200px;
          background-color: white;
      }

      .node.dragging .node-rect {
          stroke: #ff6363;
          stroke-width: 10;
          fill: #fff;
      }

      .node:not(.dragging).drop-over .node-rect {
          stroke: #ccc;
          stroke-width: 10;
      }
  </style>
</head>

<body>
<div class="action-buttons" style="margin: 0 100px">
  <button
    onclick='chart.setExpanded("103").render()'
    class="simptip-position-bottom"
    data-tooltip='chart.setExpanded("103") &#xa; .render()'
  >
    Expand #103
  </button>
  <button
    onclick='chart.setExpanded("103",false).render()'
    class="simptip-position-bottom"
    data-tooltip='chart.setExpanded("103",false) &#xa; .render()'
  >
    Collapse #103
  </button>
  <button
    onclick='chart.addNode({id:"root child",parentId:"100",name:"test-name",position:"test-position",_centered:true})'
    class="simptip-position-bottom"
    data-tooltip='chart.addNode({id:"root child",parentId:"100",name:"test name",position:"test position"})'
  >
    Add node as roots' child
  </button>
  <button onclick='chart.removeNode("120")' class="simptip-position-bottom" data-tooltip='chart.removeNode("120")'>
    Remove #120
  </button>
  <button onclick="chart.fit()" class="simptip-position-bottom" data-tooltip="chart.fit()">Fit</button>
  <button
    onclick='chart.layout(["right","bottom","left","top"][index++%4]).render().fit()'
    class="simptip-position-bottom"
    data-tooltip='chart.layout(["right","bottom","left","top"][index++%4]) &#xa; .render() &#xa; .fit()'
  >
    Swap Layouts
  </button>

  <button
    onclick='chart.setCentered("134").render()'
    class="simptip-position-bottom"
    data-tooltip='chart.setCentered("134") &#xa; .render()'
  >
    Center #134
  </button>
  <button
    onclick='chart.setHighlighted("134").render()'
    class="simptip-position-bottom"
    data-tooltip='chart.setHighlighted("134") &#xa; .render()'
  >
    Highlight #134
  </button>
  <button
    onclick='chart.setUpToTheRootHighlighted("134").render()'
    class="simptip-position-bottom"
    data-tooltip='chart.setUpToTheRootHighlighted("134") &#xa; .render()'
  >
    Highlight #134 to root
  </button>
  <button
    onclick="chart.clearHighlighting()"
    class="simptip-position-bottom"
    data-tooltip="chart.clearHighlighting() &#xa; .render()"
  >
    Clear highlighting
  </button>
  <button onclick="chart.fullscreen()" class="simptip-position-bottom" data-tooltip="chart.fullscreen()">
    Full Screen
  </button>
  <button onclick="chart.zoom(1)" class="simptip-position-bottom" data-tooltip="chart.zoom(1)">Zoom Reset</button>
  <button onclick="chart.zoomIn()" class="simptip-position-bottom" data-tooltip="chart.zoomIn()">Zoom In</button>
  <button onclick="chart.zoomOut()" class="simptip-position-bottom" data-tooltip="chart.zoomOut()">Zoom Out</button>
  <button onclick="chart.exportImg()" class="simptip-position-bottom" data-tooltip="chart.exportImg()">
    Export Current Image
  </button>
  <button
    onclick="chart.exportImg({full:true})"
    class="simptip-position-bottom"
    data-tooltip="chart.exportImg({full:true})"
  >
    Export Export Full Image
  </button>
  <button onclick="chart.exportSvg()" class="simptip-position-bottom" data-tooltip="chart.exportSvg()">
    Export SVG
  </button>
  <button onclick="chart.expandAll()" class="simptip-position-bottom" data-tooltip="chart.expandAll()">
    Expand All
  </button>
  <button onclick="chart.collapseAll()" class="simptip-position-bottom" data-tooltip="chart.collapseAll()">
    Collapse All
  </button>
  <button
    onclick='chart.connections([{from:"145",to:"201",label:"Conflicts of interest"}]).render()'
    class="simptip-position-bottom"
    data-tooltip='chart.connections({from:"",to:""}) &#xa; .render()'
  >
    Multi Node Connections
  </button>

  <button onclick="() => downloadPdf()" class="simptip-position-bottom" data-tooltip="downloadPdf()">Download PDF</button>
</div>

<div class="chart-container"></div>

<script src="https://d3js.org/d3.v7.min.js"></script>

<script>
  let index = 0;
  let chart;
  d3.csv('demo/data.csv').then((dataFlattened) => {
    chart = new OrgChart({
      container: document.querySelector('.chart-container'),
      data: dataFlattened,
      nodeHeight: () => 85 + 25,
      nodeWidth: () => 220 + 2,
      childrenMargin: () => 50,
      compactNoChildren: true,
      onNodeClick: () => console.log('ok'),
      compactMarginBetween: () => 35,
      compactMarginPair: () => 30,
      neighbourMargin: () => 40,
      dragNDrop: true,
      onNodeDrop: function (sourceNodeData, targetNodeData) {
        console.log(sourceNodeData, targetNodeData);
        return true;
      },
      isNodeDraggable: () => true,
      isNodeDroppable: () => true,
      layoutBindings: {
        top: {
          linkY: (node) => node.y + 0,
          linkCompactYStart: (node) => node.y + node.height / 2 + 15,
        },
      },
    });

    chart.render();
  });

  function downloadPdf() {
    chart.exportImg({
      save: false,
      onLoad: (base64) => {
        var pdf = new jspdf.jsPDF();
        var img = new Image();
        img.src = base64;
        img.onload = function () {
          pdf.addImage(img, 'JPEG', 5, 5, 595 / 3, ((img.height / img.width) * 595) / 3);
          pdf.save('chart.pdf');
        };
      },
    });
  }
</script>
</body>
</html>
